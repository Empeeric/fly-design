<!doctype html>
<html>
<head>
    <meta charset="UTF-8">
    <title>prlx.js</title>
    <style>
        body {
            text-align: center;
            padding: 50px;
        }
        h1 {
            position: relative;
        }
        div {
            width: 800px;
            margin: 20px auto;
        }
        .long {
            height: 1200px;
            background: #077780;
        }
        .short {
            height: 500px;
            background: #fa466c;
        }
    </style>
</head>
<body>

<div class="long"></div>

<h1>No I haven't</h1>

<div class="long"></div>
<!--<div class="short"></div>-->

<script src="components/jquery/jquery.min.js"></script>
<script>
    /*var w = $(window).scroll(function() {
        var scroll_top = w.scrollTop(),
            easing = $.easing.swing;

        $.each(elements, function(props, selector) {
            var el = $(selector),
                el_top = el.offset().top,
                top = scroll_top - el_top,
                css = {}, p, prop, start, end;

            for (p in props) {
                prop = props[p];
                start = prop[0];
                end = prop[1];
                if (top < start[0])
                    css[p] = start[1];
                else if (top > end[0])
                    css[p] = end[1];
                else
                    css[p] = easing(end[1] - start[0])
            }

            $(el).css(css);
        });
    });

    var elements = {
        'h1': {
            opacity: [ [ 0, 0 ], [ 500, 1 ] ]
        }
    }

    var prlx = function(elements) {

        var animations = $.each(elements, function(selector, ) {
            var a =

            return a;
        });

        var w = $(window).scroll(function() {
            var scroll_top = w.scrollTop();

            animations.forEach(function(a) {
                a(scroll_top);
            });
        });
    };

    prlx({
        'h1': { opacity: [ [0, 0], [500, 0] ] }
    });*/

    (function() {
        var listeners = [],
            w = $(window).scroll(function() {
                var scroll_top = w.scrollTop(),
                    height = w.height();
                listeners.forEach(function(l) {
                    l[1].call(l[0], scroll_top, height);
                });
            });

        $.fn.prlx = function(fn) {
            if (!this.length) return this;

            if ('string' == typeof fn )
                fn = $.prlx.main.apply(this, arguments);

            listeners.push([this, fn]);
            return this;
        };

        $.prlx = {
            fadeOut: function(top) {
                var offset = this.offset().top,
                    distance = offset - top,
                    c = distance / offset;

                this.css('opacity', c);
            },
            fadeIn: function(top) {
                var h = this.height(),
                    offset = this.offset().top + h,
                    bottom = top + $(window).height(),
                    distance = bottom - offset,
                    c = distance / h + 1;

                this.css('opacity', c);
            },
            main: function(prop, start, end) {
                if (start.top > end.top || start.bottom < end.bottom) {
                    var temp = start;
                    start = end;
                    end = temp;
                }

                return function(scroll_top, window_height) {
                    var offset = this.offset().top,
                        distance = offset - scroll_top,
                        c;

                    if (start.top == undefined)
                        start.top = window_height - start.bottom;
                    if (end.top == undefined)
                        end.top = window_height - end.bottom;

                    if (distance < start.top)
                        c = start.val;
                    else if (distance > end.top)
                        c = end.val;
                    else
                        c = (distance - start.top)
                            / (end.top - start.top)
                            * (end.val - start.val)
                            +  start.val;

                    this.css(prop, c);
                    console.log(distance, start.top, end.top);
                }
            }
        };
    })();

    $('h1').prlx('left',
        { top: 500, val: 200 },
        { top: 12, val: 12 }
    ).prlx('opacity',
        { bottom: 400, val: 1 },
        { bottom: 0, val: 0 }
    );

</script>

</body>
</html>